---
title: ""
---
import { Code } from '@astrojs/starlight/components';

<Fragment set:html={`
          <section id="compiling-to-avm-bytecode">
<h1>Compiling to AVM bytecode<a class="headerlink" href="#compiling-to-avm-bytecode" title="Link to this heading">¶</a></h1>
<p>The PuyaPy compiler can compile Algorand Python smart contracts directly into AVM bytecode.
Once compiled, this bytecode can be utilized to construct AVM Application Call transactions both on and off chain.</p>
<section id="outputting-avm-bytecode-from-cli">
`} />
## Outputting AVM bytecode from CLI

<Fragment set:html={`
<p>The <code class="docutils literal notranslate"><span class="pre">--output-bytecode</span></code> option can be used to generate <code class="docutils literal notranslate"><span class="pre">.bin</span></code> files for smart contracts and logic signatures, producing an approval and clear program for each smart contract.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Puya compiler incorporates several optimizations that are not present in the bytecode output generated by the
<a class="reference external" href="https://developer.algorand.org/docs/rest-apis/algod/#post-v2tealcompile"><code class="docutils literal notranslate"><span class="pre">/v2/teal/compile</span></code></a> endpoint.
When comparing the outputs of PuyaPy and Algod these differences may be observed.
To disable these optimizations and produce bytecode identical to Algod use the <code class="docutils literal notranslate"><span class="pre">--match-algod-bytecode</span></code> option.</p>
</div>
</section>
<section id="obtaining-bytecode-within-other-contracts">
`} />
## Obtaining bytecode within other contracts

<Fragment set:html={`
<p>The <a class="reference internal" href="../api-algopy.html#algopy.compile_contract" title="algopy.compile_contract"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">compile_contract</span></code></span></a> function takes an Algorand Python smart contract class and returns a <a class="reference internal" href="../api-algopy.html#algopy.CompiledContract" title="algopy.CompiledContract"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">CompiledContract</span></code></span></a>,
The global state, local state and program pages allocation parameters are derived from the contract by default, but can be overridden.
This compiled contract can then be used to create an <a class="reference internal" href="../api-algopy.itxn.html#algopy.itxn.ApplicationCall" title="algopy.itxn.ApplicationCall"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">algopy.itxn.ApplicationCall</span></code></span></a> transaction or used with the <a class="reference internal" href="#arc4-contracts"><span class="xref myst">ARC4</span></a> functions.</p>
<p>The <a class="reference internal" href="../api-algopy.html#algopy.compile_logicsig" title="algopy.compile_logicsig"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">compile_logicsig</span></code></span></a> takes an Algorand Python logic signature and returns a <a class="reference internal" href="../api-algopy.html#algopy.CompiledLogicSig" title="algopy.CompiledLogicSig"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">CompiledLogicSig</span></code></span></a>, which can be used to
verify if a transaction has been signed by a particular logic signature.</p>
</section>
<section id="arc4-contracts">
`} />
## ARC4 contracts

<Fragment set:html={`
<p>Additional functions are available for <a class="reference internal" href="#create"><span class="std std-ref">creating</span></a> and <a class="reference internal" href="#update"><span class="std std-ref">updating</span></a> ARC4 applications on-chain via an inner transaction.</p>
<section id="create">
`} />
### Create

<Fragment set:html={`
<p><a class="reference internal" href="../api-algopy.arc4.html#algopy.arc4.arc4_create" title="algopy.arc4.arc4_create"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">algopy.arc4.arc4_create</span></code></span></a> can be used to create ARC4 applications, and will automatically populate required fields for app creation (such as approval program, clear state program, and global/local state allocation).</p>
<p>Like <a class="reference internal" href="../lg-transactions.html#arc4-application-calls"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">algopy.arc4.abi_call</span></code></span></a> it handles ARC4 arguments and provides ARC4 return values.</p>
<p>If the compiled programs and state allocation fields need to be customized (for example due to <a class="reference internal" href="#within-other-contracts"><span class="xref myst">template variables</span></a>),
this can be done by passing a <a class="reference internal" href="../api-algopy.html#algopy.CompiledContract" title="algopy.CompiledContract"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">algopy.CompiledContract</span></code></span></a> via the <code class="docutils literal notranslate"><span class="pre">compiled</span></code> keyword argument.</p>
`} /><Code code={`<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">algopy</span> <span class="kn">import</span> <span class="n">ARC4Contract</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">arc4</span><span class="p">,</span> <span class="n">subroutine</span>

<span class="k">class</span> <span class="nc">HelloWorld</span><span class="p">(</span><span class="n">ARC4Contract</span><span class="p">):</span>
    
    <span class="nd">@arc4</span><span class="o">.</span><span class="n">abimethod</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">"Hello "</span> <span class="o">+</span> <span class="n">name</span>

<span class="nd">@subroutine</span>
<span class="k">def</span> <span class="nf">create_new_application</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">hello_world_app</span> <span class="o">=</span> <span class="n">arc4</span><span class="o">.</span><span class="n">arc4_create</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">)</span><span class="o">.</span><span class="n">created_app</span>

    <span class="n">greeting</span><span class="p">,</span> <span class="n">_txn</span> <span class="o">=</span> <span class="n">arc4</span><span class="o">.</span><span class="n">abi_call</span><span class="p">(</span><span class="n">HelloWorld</span><span class="o">.</span><span class="n">greet</span><span class="p">,</span> <span class="s2">"there"</span><span class="p">,</span> <span class="n">app_id</span><span class="o">=</span><span class="n">hello_world_app</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">greeting</span> <span class="o">==</span> <span class="s2">"Hello there"</span>
</pre></div>
</div>`} lang='py' frame='none' /><Fragment set:html={`
</section>
<section id="update">
`} />
### Update

<Fragment set:html={`
<p><a class="reference internal" href="../api-algopy.arc4.html#algopy.arc4.arc4_update" title="algopy.arc4.arc4_update"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">algopy.arc4.arc4_update</span></code></span></a> is used to update an existing ARC4 application and will automatically populate the required approval and clear state program fields.</p>
<p>Like <a class="reference internal" href="../lg-transactions.html#arc4-application-calls"><span class="std std-ref"><code class="docutils literal notranslate"><span class="pre">algopy.arc4.abi_call</span></code></span></a> it handles ARC4 arguments and provides ARC4 return values.</p>
<p>If the compiled programs need to be customized (for example due to (for example due to <a class="reference internal" href="#within-other-contracts"><span class="xref myst">template variables</span></a>),
this can be done by passing a <a class="reference internal" href="../api-algopy.html#algopy.CompiledContract" title="algopy.CompiledContract"><span class="xref myst py py-class"><code class="docutils literal notranslate"><span class="pre">algopy.CompiledContract</span></code></span></a> via the <code class="docutils literal notranslate"><span class="pre">compiled</span></code> keyword argument.</p>
`} /><Code code={`<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">algopy</span> <span class="kn">import</span> <span class="n">Application</span><span class="p">,</span> <span class="n">ARC4Contract</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">arc4</span><span class="p">,</span> <span class="n">subroutine</span>

<span class="k">class</span> <span class="nc">NewApp</span><span class="p">(</span><span class="n">ARC4Contract</span><span class="p">):</span>
    
    <span class="nd">@arc4</span><span class="o">.</span><span class="n">abimethod</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">"Hello "</span> <span class="o">+</span> <span class="n">name</span>

<span class="nd">@subroutine</span>
<span class="k">def</span> <span class="nf">update_existing_application</span><span class="p">(</span><span class="n">existing_app</span><span class="p">:</span> <span class="n">Application</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">hello_world_app</span> <span class="o">=</span> <span class="n">arc4</span><span class="o">.</span><span class="n">arc4_update</span><span class="p">(</span><span class="n">NewApp</span><span class="p">,</span> <span class="n">app_id</span><span class="o">=</span><span class="n">existing_app</span><span class="p">)</span>
    
    <span class="n">greeting</span><span class="p">,</span> <span class="n">_txn</span> <span class="o">=</span> <span class="n">arc4</span><span class="o">.</span><span class="n">abi_call</span><span class="p">(</span><span class="n">NewApp</span><span class="o">.</span><span class="n">greet</span><span class="p">,</span> <span class="s2">"there"</span><span class="p">,</span> <span class="n">app_id</span><span class="o">=</span><span class="n">hello_world_app</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">greeting</span> <span class="o">==</span> <span class="s2">"Hello there"</span>
</pre></div>
</div>`} lang='py' frame='none' /><Fragment set:html={`
</section>
</section>
<section id="template-variables">
`} />
## Template variables

<Fragment set:html={`
<p>Algorand Python supports defining <a class="reference internal" href="../api-algopy.html#algopy.TemplateVar" title="algopy.TemplateVar"><span class="xref myst py py-data"><code class="docutils literal notranslate"><span class="pre">algopy.TemplateVar</span></code></span></a> variables that can be substituted during compilation.</p>
<p>For example, the following contract has <code class="docutils literal notranslate"><span class="pre">UInt64</span></code> and <code class="docutils literal notranslate"><span class="pre">Bytes</span></code> template variables.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">templated_contract.py</span><a class="headerlink" href="#id1" title="Link to this code">¶</a></div>
`} /><Code code={`<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">algopy</span> <span class="kn">import</span> <span class="n">ARC4Contract</span><span class="p">,</span> <span class="n">Bytes</span><span class="p">,</span> <span class="n">TemplateVar</span><span class="p">,</span> <span class="n">UInt64</span><span class="p">,</span> <span class="n">arc4</span>


<span class="k">class</span> <span class="nc">TemplatedContract</span><span class="p">(</span><span class="n">ARC4Contract</span><span class="p">):</span>

    <span class="nd">@arc4</span><span class="o">.</span><span class="n">abimethod</span>
    <span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UInt64</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TemplateVar</span><span class="p">[</span><span class="n">UInt64</span><span class="p">](</span><span class="s2">"SOME_UINT"</span><span class="p">)</span>

    <span class="nd">@arc4</span><span class="o">.</span><span class="n">abimethod</span>
    <span class="k">def</span> <span class="nf">my_other_method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bytes</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TemplateVar</span><span class="p">[</span><span class="n">Bytes</span><span class="p">](</span><span class="s2">"SOME_BYTES"</span><span class="p">)</span>
</pre></div>
</div>`} lang='py' frame='none' /><Fragment set:html={`
</div>
<p>When compiling to bytecode, the values for these template variables must be provided. These values can be provided via the CLI,
or through the <code class="docutils literal notranslate"><span class="pre">template_vars</span></code> parameter of the <a class="reference internal" href="../api-algopy.html#algopy.compile_contract" title="algopy.compile_contract"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">compile_contract</span></code></span></a> and <a class="reference internal" href="../api-algopy.html#algopy.compile_logicsig" title="algopy.compile_logicsig"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">compile_logicsig</span></code></span></a> functions.</p>
<section id="cli">
`} />
### CLI

<Fragment set:html={`
<p>The <code class="docutils literal notranslate"><span class="pre">--template-var</span></code> option can be used to <a class="reference internal" href="../compiler.html#defining-template-values"><span class="std std-ref">define</span></a> each variable.</p>
<p>For example to provide the values for the above example contract the following command could be used
<code class="docutils literal notranslate"><span class="pre">puyapy</span> <span class="pre">--template-var</span> <span class="pre">SOME_UINT=123</span> <span class="pre">--template-var</span> <span class="pre">SOME_BYTES=0xABCD</span> <span class="pre">templated_contract.py</span></code></p>
</section>
<section id="within-other-contracts">
`} />
### Within other contracts

<Fragment set:html={`
<p>The functions <a class="reference internal" href="../api-algopy.html#algopy.compile_contract" title="algopy.compile_contract"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">compile_contract</span></code></span></a> and <a class="reference internal" href="../api-algopy.html#algopy.compile_logicsig" title="algopy.compile_logicsig"><span class="xref myst py py-func"><code class="docutils literal notranslate"><span class="pre">compile_logicsig</span></code></span></a> both have an optional <code class="docutils literal notranslate"><span class="pre">template_vars</span></code> parameter
which can be used to define template variables. Variables defined in this manner take priority over variables defined on the CLI.</p>
`} /><Code code={`<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">algopy</span> <span class="kn">import</span> <span class="n">Bytes</span><span class="p">,</span> <span class="n">UInt64</span><span class="p">,</span> <span class="n">arc4</span><span class="p">,</span> <span class="n">compile_contract</span><span class="p">,</span> <span class="n">subroutine</span>

<span class="kn">from</span> <span class="nn">templated_contract</span> <span class="kn">import</span> <span class="n">TemplatedContract</span>

<span class="nd">@subroutine</span>
<span class="k">def</span> <span class="nf">create_templated_contract</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">compiled</span> <span class="o">=</span> <span class="n">compile_contract</span><span class="p">(</span>
        <span class="n">TemplatedContract</span><span class="p">,</span>
        <span class="n">global_uints</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># customize allocated global uints</span>
        <span class="n">template_vars</span><span class="o">=</span><span class="p">{</span> <span class="c1"># provide template vars</span>
            <span class="s2">"SOME_UINT"</span><span class="p">:</span> <span class="n">UInt64</span><span class="p">(</span><span class="mi">123</span><span class="p">),</span>
            <span class="s2">"SOME_BYTES"</span><span class="p">:</span> <span class="n">Bytes</span><span class="p">(</span><span class="sa">b</span><span class="s2">"</span><span class="se">\xAB\xCD</span><span class="s2">"</span><span class="p">)</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">arc4</span><span class="o">.</span><span class="n">arc4_create</span><span class="p">(</span><span class="n">TemplatedContract</span><span class="p">,</span> <span class="n">compiled</span><span class="o">=</span><span class="n">compiled</span><span class="p">)</span>
</pre></div>
</div>`} lang='py' frame='none' />